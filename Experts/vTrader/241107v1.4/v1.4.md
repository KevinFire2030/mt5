# 1. 서머타임 체크 함수:

```cpp
// 미국 서머타임 (3월 둘째 일요일 ~ 11월 첫째 일요일)
bool IsDaylightSavingTime(datetime time = 0)
{
    // 1-2월, 12월: 서머타임 아님
    // 4-10월: 서머타임
    // 3월, 11월: 특정 일요일 기준으로 체크
}
```
# 2. 거래 시간대:

// 1. 뉴욕 장시작 2시간 (09:30-11:30 ET)
서머타임: MT5 시간 15:30-17:30
겨울시간: MT5 시간 16:30-18:30

// 2. 뉴욕 장마감 1시간 (15:00-16:00 ET)
서머타임: MT5 시간 21:00-22:00
겨울시간: MT5 시간 22:00-23:00

# 3. 구현 파일:

vTrader_v1.2_trade_time.mqh:
- CvTrader 클래스 정의
- 거래 관련 기본 기능

vTrader_v1.2_trade_time.mq5:
- EA 메인 파일
- 서머타임 체크 및 거래 시간 필터 적용

# 4. 주요 기능
- 서머타임/겨울시간 자동 감지
- 뉴욕 시장 시작/마감 시간대 거래
- 시간대별 거래 필터링
- 실시간 거래 시간 체크

## 2023-11-07 수정 내역

### 1. 거래 통계 보정 (profit 100배 문제 해결)
- vTrader_v1.2_trade_time.mq5의 OnTester() 함수에서 profit 값 보정
  - profit, commission, swap 값을 100으로 나누어 실제 금액으로 조정
  ```mq5
  double profit = HistoryDealGetDouble(ticket, DEAL_PROFIT) / 100.0;
  double commission = HistoryDealGetDouble(ticket, DEAL_COMMISSION) / 100.0;
  double swap = HistoryDealGetDouble(ticket, DEAL_SWAP) / 100.0;
  ```

### 2. 거래 내역 분석 기능 개선 (deal_history2.mq5)
- TradeRecord 구조체 확장
  - order, position_id, sl, tp 등 추가 필드
  - 거래 사유, 진입 유형, pips 정보 추가
- 유틸리티 함수 추가
  - GetDealReasonString(): 거래 사유 문자열 변환
  - GetEntryTypeString(): 진입 유형 문자열 변환
  - CalculatePips(): pips 계산
- 통계 분석 기능 강화
  - RR비율 계산
  - Win RR (필요 RR비율) 계산
  - Trading Edge (TE) 계산

### 3. 파일 저장 개선 (deal_history.mq5)
- 파일 저장 경로 단순화
- 에러 처리 개선
- 0으로 나누기 방지 로직 추가

### 4. 통계 분석 결과
백테스팅 결과 예시:


총 거래 수: 900
승리: 297 | 패배: 603
승률: 33.00%
총 손익: 148.94
평균 수익: 1.85
평균 손실: 0.67
RR비율: 2.78 (Win RR > 2.03)
TE: 0.17

- 낮은 승률(33%)을 높은 RR비율(2.78)로 보완
- 실제 RR비율이 필요 RR비율보다 높아 수익 시스템
- 양수의 TE로 장기적 수익성 확인

2024.11.07 12:23:17.153	2024.11.05 23:58:59   === 거래 통계 ===
2024.11.07 12:23:17.153	2024.11.05 23:58:59   총 거래 수: 900
2024.11.07 12:23:17.153	2024.11.05 23:58:59   승리: 297 | 패배: 603
2024.11.07 12:23:17.153	2024.11.05 23:58:59   승률: 33.00%
2024.11.07 12:23:17.153	2024.11.05 23:58:59   총 손익: 14894.45
2024.11.07 12:23:17.153	2024.11.05 23:58:59   평균 수익: 185.17
2024.11.07 12:23:17.153	2024.11.05 23:58:59   평균 손실: 66.50
2024.11.07 12:23:17.153	2024.11.05 23:58:59   RR비율: 2.78 (Win RR > 2.03)
2024.11.07 12:23:17.153	2024.11.05 23:58:59   TE: 16.55


2024.11.07 12:36:21.169	2024.11.05 23:58:59   === 거래 통계 ===
2024.11.07 12:36:21.169	2024.11.05 23:58:59   총 거래 수: 900
2024.11.07 12:36:21.169	2024.11.05 23:58:59   승리: 297 | 패배: 603
2024.11.07 12:36:21.169	2024.11.05 23:58:59   승률: 33.00%
2024.11.07 12:36:21.169	2024.11.05 23:58:59   총 손익: 148.94
2024.11.07 12:36:21.169	2024.11.05 23:58:59   평균 수익: 1.85
2024.11.07 12:36:21.169	2024.11.05 23:58:59   평균 손실: 0.67
2024.11.07 12:36:21.169	2024.11.05 23:58:59   RR비율: 2.78 (Win RR > 2.03)
2024.11.07 12:36:21.169	2024.11.05 23:58:59   TE: 0.17


2024.01.01 ~ 2024.11.05
Deposit: 1000000
// 테스트용 고정 계좌 잔고
        double balance = TEST_BALANCE;  // $100

2024.11.07 12:55:16.177	2024.11.05 23:58:59   === 거래 통계 ===
2024.11.07 12:55:16.177	2024.11.05 23:58:59   총 거래 수: 7311
2024.11.07 12:55:16.177	2024.11.05 23:58:59   승리: 2015 | 패배: 5296
2024.11.07 12:55:16.177	2024.11.05 23:58:59   승률: 27.56%
2024.11.07 12:55:16.177	2024.11.05 23:58:59   총 손익: 9797.93
2024.11.07 12:55:16.177	2024.11.05 23:58:59   평균 수익: 6.62
2024.11.07 12:55:16.177	2024.11.05 23:58:59   평균 손실: 0.67
2024.11.07 12:55:16.177	2024.11.05 23:58:59   RR비율: 9.91 (Win RR > 2.63)
2024.11.07 12:55:16.177	2024.11.05 23:58:59   TE: 1.34


2000.01.01 ~ 2024.11.05
Deposit: 1000000
// 테스트용 고정 계좌 잔고
        double balance = TEST_BALANCE;  // $100
* 테스트 시간: 1h47m

2024.11.07 14:46:44.492	2024.11.05 23:58:59   === 거래 통계 ===
2024.11.07 14:46:44.492	2024.11.05 23:58:59   총 거래 수: 72600
2024.11.07 14:46:44.492	2024.11.05 23:58:59   승리: 17909 | 패배: 54691
2024.11.07 14:46:44.492	2024.11.05 23:58:59   승률: 24.67%
2024.11.07 14:46:44.492	2024.11.05 23:58:59   총 손익: 138.61
2024.11.07 14:46:44.492	2024.11.05 23:58:59   평균 수익: 2.18
2024.11.07 14:46:44.492	2024.11.05 23:58:59   평균 손실: 0.71
2024.11.07 14:46:44.492	2024.11.05 23:58:59   RR비율: 3.06 (Win RR > 3.05)
2024.11.07 14:46:44.492	2024.11.05 23:58:59   TE: 0.00


* 거래시간 종료시 포지션 청산 추가

### 5. 전체 기간 백테스트 결과 (2000.01.01 ~ 2024.11.05)

**테스트 환경**
- 기간: 2000.01.01 ~ 2024.11.05 (약 24년)
- 초기 증거금: $1,000,000
- 테스트 계좌 잔고: $100 (고정)
- 테스트 소요 시간: 1시간 47분

**거래 통계**
- 총 거래 수: 72,600건
- 승리: 17,909건 | 패배: 54,691건
- 승률: 24.67%
- 총 손익: $138.61
- 평균 수익: $2.18
- 평균 손실: $0.71
- RR비율: 3.06 (Win RR > 3.05)
- TE: 0.00

**분석**
1. **거래량**
   - 24년간 72,600건의 거래 (일평균 약 8.3건)
   - 충분한 샘플 수로 통계적 신뢰성 확보

2. **승률과 RR비율**
   - 낮은 승률(24.67%)을 높은 RR비율(3.06)로 보완
   - Win RR(3.05)과 실제 RR비율(3.06)이 거의 동일
   - 장기적으로 수익과 손실이 균형을 이루는 구조

3. **수익성**
   - 총 수익 $138.61 (테스트 계좌 잔고 $100 기준)
   - TE가 0에 가까워 장기적으로 안정적인 성과
   - 평균 수익($2.18)이 평균 손실($0.71)의 약 3배

4. **리스크 관리**
   - RR비율이 Win RR과 거의 일치하여 최적화된 상태
   - 낮은 승률을 감안한 적절한 리스크 관리 필요
